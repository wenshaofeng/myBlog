## 市面上的私有npm库方案



- sinopia（verdaccio，是sinopia的替身）
- cnpm + cnpmjs.org
- cpm（nilppm，是cpm的替身）



## 方案对比

- verdaccio比较偏向于一个零配置、轻量型的私有npm模块管理工具，不需要额外的数据库配置，它内部自带小型数据库，支持私有模块管理的同时也支持缓存使用过的公共模块，发布及缓存的模块以静态资源形式本地存储。支持静态配置型用户管理机制，以及分层模块权限设置。

- cnpm可以实现公共模块镜像更新以及私有模块管理，支持拓展多种存储形式，相对的数据库的配置较多，部署过程略复杂。是淘宝及多家大型公司搭建内部私有npm仓库选择的方案。

- cnpm的方案在部署过程以及整体设计上要比Sinopia复杂的多，维护成本也比较高；但相对的也提供更高的扩展性，可以支持多种业务场景；

- nilppm职责专一，只对私有包进行管理，相比cnpm，它不涉及同步模式，毕竟同步模式带来的磁盘开销太大。在路由层速度有先天优势（nilppm通过`radix tree`算法实现，而cnpm则通过KOA-ROUTER实现）。另外安装布署也极为简单。

  

verdaccio的主要缺点有以下几个：

- 权限管理比较弱，对用户权限，发布权限，下载权限控制不是很得心应手；
- 缓存优化不足，经常会在安装共有包的时候处于挂起状态；
- 不能做官方仓库的镜像。



## 公司现状

目前使用的是verdaccio，已知的问题有几个以下：

- 权限管理（但这一块可以基本忽略，因为平常大家也不怎么care）
- 有一定概率在安装时，会处于挂起状态，即失败的情况
- search时，有些包明明存在，但一开始搜索不出来，然而过几天看就有了（陈超童鞋反馈）
- web界面没有homeURL（即没法关联gitlab地址）
- 没有下载的数据统计（如周下载、月下载等），当然这个功能也未必需要



另外涉及到上传到私库的组件包名、包文件规范等。



## 解决方案

可以尝试使用`cnpm`来替代`verdaccio`，不过cnpm会有一个问题是关于磁盘的开销问题，所以这里也可以去尝试使用一下`nilppm`。



### 可能碰到的问题

- 是否有必要默认所有公司账号的注册，如果要实现，看看目前的几个方案是否能支持。如不能支持，得尝试去改写内部源码
- 对`cnpm`的配置不熟，导致上手会慢一些





